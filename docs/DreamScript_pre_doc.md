# DreamScript

> 此文档为预实现文档，为 [完整设计预案](DreamScript_doc.md) 的缩略版，精简了语法并增加了诸多使用限制，旨在短期内完成样例进行测试

## 语法及示例

### 对话脚本：

+ 按行解析
+ 说话者与内容使用 `*` 分隔，`*` 前后的空格将会被忽略
+ 如果需要在文本中使用 `*`，请使用 `**` 替换一个 `*`
+ 说话者或者内容均可以省略
    
示例如下：

```
老八 * 今天小汉堡买一赠一
* 听到这句话，杯中82年的拉菲突然就不香了

李华 * 我**尼玛，又让我给国外网友写信
```

### 单行注释：

+ 以 `%%` 作为行开头的内容，整行解析为注释

示例如下：
    
```
%% 言语粗俗，可能会对未成年人产生不良影响，后续联系策划修改人物性格设定
李华 * 我**尼玛，又让我给国外网友写信
```

### 多行注释：

+ 以 `%{` 作为行开头，直到以 `}%` 作为行结尾的内容，都将解析为注释
+ 多行注释不支持嵌套

示例如下：

```
%{
    这是一个多行注释
}%
老八 * 今天小汉堡买一赠一

%{ 这也是一个多行注释 }%
老八 * 今天小汉堡买一赠一
```

### 单行指令：

+ 以 `@` 或 `$` 作为行开头的内容，整行解析为 Lua 代码并在合适的时机调用
+ `@` 为向下绑定，`$` 为向上绑定
+ 解析完成后的 Lua 代码将不做处理直接运行，所以需要注意此处的 Lua 虚拟机上下文环境
+ 单行代码中遵循 Lua 的语法，如使用 `--` 进行行注释

示例如下：

```
@ MyCommand.MakeGameAAAAAa()
老八 * 今天小汉堡买一赠一

@ favor = favor + 1     -- 好感度提升 1 点 
老八 * 今天小汉堡买一赠一
```

### 多行指令：

+ 以 `@{` 或 `${` 作为行开头，直到以 `}@` 或 `}$` 作为行结尾的内容，都将解析为 Lua 代码并在合适的时机调用
+ `@{` 和 `}@` 必须保持配对，`${` 和 `}$` 必须保持配对
+ `@{ }@` 为向下绑定，`${ }$` 为向上绑定
+ 解析完成后的 Lua 代码将不做处理直接运行，所以需要注意此处的 Lua 虚拟机上下文环境
+ 单行代码中遵循 Lua 的语法，如使用 `--` 进行行注释
+ 多行代码不支持嵌套

示例如下：

```
@{
    if favor > 10 then
        character.SetFace("shy")    -- 如果角色好感度大于 10 点，则将面部表情切换为 “害羞”
    else
        JumpLabelTo("battle")       -- 否则跳转到 "battle" 标签处进行战斗场景
    end
}@
老八 * 今天小汉堡买一赠一
```

### 标签：

+ 标签是为剧本跳转锚定设计的，配合内置全局指令 `@JumpToLabel` 使用
+ 标签以 `#` 开头，并且占据单独的一行
+ 标签是全局可见性，即可以实现在不同脚本文件间进行跳转
+ 请务必确保标签名的唯一性，重名的标签可能会发生覆盖，并且发生不可预知的执行顺序

示例如下：

```
%% 一直做梦……

# dream_start 1
@JumpToLabel("dream_start 2")
* 梦开始的地方

# dream_start 2
@JumpToLabel("dream_start 1")
```